# Memory Bank

Memory Bank — модуль для хранения, генерации и обмена знаниями, решениями, паттернами и контекстом между проектами, AI-ассистентами и командой.

## Структура
- core-файлы: activeContext.md, decisionLog.md, productContext.md, progress.md, projectBrief.md, systemPatterns.md
- custom_modes/ — инструкции и YAML-конфиги для режимов работы (Architect, Code, Ask, Debug)
- knowledge_packages/ — примеры, паттерны, брифы, phase-файлы
- .cursor/rules/isolation_rules/ — изоляционные правила и примеры
- developer-primer.md — гайд для разработчиков
- process-map.md — визуальные карты процессов

## Основано на:
- https://github.com/vanzan01/cursor-memory-bank
- https://github.com/GreatScottyMac/roo-code-memory-bank

## Как использовать
1. Заполняйте core-файлы по мере работы над проектом.
2. Следуйте инструкциям и YAML-конфига в custom_modes/ для разных фаз.
3. Используйте knowledge_packages/ как примеры и шаблоны.
4. Для интеграции с AI и автоматизации — используйте REST/MCP endpoint'ы.

## Best practices
- Все шаблоны и знания оформлять в формате markdown
- Документировать каждое решение и паттерн
- Использовать визуализацию (Mermaid, Graphviz) для процессов
- Поддерживать актуальность projectBrief.md и productContext.md 

## Интеграция с MCP/Task Tracker

> **Внимание:** В рамках Cursor AI MCP все задачи, баги, улучшения и прогресс фиксируются исключительно в основном сервисе (MCP/Task Tracker). Memory Bank не является таск-трекером, а служит журналом и контекстным отражением для AI, автоматизации и команды.

### Рекомендации по интеграции
- Все новые задачи, баги, улучшения создаются и обновляются только через MCP (API, UI, CLI).
- Memory Bank автоматически синхронизируется с MCP: события, статусы, решения, прогресс отражаются в core-файлах (decisionLog.md, activeContext.md, progress.md и др.).
- ACT (AI Context Tracker) отслеживает действия в MCP и обновляет Memory Bank для поддержки AI, federation и автоматизации.
- Не допускается ручное добавление задач или багов напрямую в Memory Bank — только через MCP.

### Пример workflow
1. Пользователь ставит задачу через MCP (UI/API).
2. MCP сохраняет задачу, присваивает ID, обновляет статус.
3. MCP отправляет событие в Memory Bank (decisionLog.md, activeContext.md).
4. ACT отслеживает действия, обновляет историю и контекст в Memory Bank.
5. При появлении багов/улучшений — фиксировать их только в MCP, а Memory Bank отражает эти события для AI и автоматизации.

> **Важно:** Memory Bank — это "журнал" и "контекстная шина". Все задачи и баги ведутся только в MCP. Memory Bank хранит историю, решения и контекст для AI и команды.

### Чеклист: Проверка подключения к MCP/Task Tracker

- [ ] Выполнен healthcheck MCP API (`/health`)
- [ ] Получен валидный ответ и статус "OK"
- [ ] Тестовая задача из MCP появилась в Memory Bank
- [ ] Логи интеграции фиксируют успешную синхронизацию
- [ ] В интерфейсе Memory Bank отображается статус подключения 

## Архивация и индексация для больших проектов
- При превышении 100КБ knowledge packages или логов используйте архивирование (например, перенос старых файлов в архив/архивные папки).
- Для быстрого поиска используйте индексацию по ключевым словам, датам, авто-генерацию оглавлений.

## План миграции структуры Memory Bank
- Перед изменением структуры делайте полный бэкап.
- Используйте скрипты миграции для переноса данных между версиями структуры.
- Все миграции фиксируйте в auditLog.md.

## Катастрофоустойчивость и DRP
- При недоступности MCP или Memory Bank используйте последний бэкап для восстановления.
- Храните резервные копии в защищённом облаке и локально.
- Регулярно тестируйте восстановление из бэкапа (DRP).
- Описывайте все действия по восстановлению в auditLog.md.

## Onboarding checklist
- [ ] Прочитать developer-primer.md и README.md
- [ ] Ознакомиться с core-файлами и knowledge packages
- [ ] Пройти инструкцию по добавлению нового knowledge package
- [ ] Ознакомиться с правилами changelog и аудита
- [ ] Настроить автоматические бэкапы

## Контроль версий и автоматизация changelog
- Все изменения фиксируются в git-истории.
- При каждом pull request или merge обновляйте CHANGELOG.md (автоматически или вручную).
- Используйте шаблон changelog из корня проекта.

## AI Automation Scenarios

- Для архивации knowledge packages вызывай:
  `mcp archive-knowledge-package <file>`
- Для миграции структуры:
  `mcp migrate-memory-bank --from <v1> --to <v2>`
- Для восстановления из бэкапа:
  `mcp restore-memory-bank <backup-file>`
- Для обновления changelog:
  `mcp update-changelog <message>`
- Для теста DRP:
  `mcp test-drp`
- Для поиска:
  `mcp search-knowledge <keyword>`

> **Важно:** Не редактируй архивные, changelog и audit файлы напрямую — только через команды MCP!

### Примеры промптов для AI
- "Архивируй knowledge package phase-dev.md"
- "Проведи тест DRP"
- "Восстанови Memory Bank из последнего бэкапа"
- "Обнови changelog после миграции" 