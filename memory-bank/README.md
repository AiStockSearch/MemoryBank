# Memory Bank

> **Внимание:** Memory Bank — это только шаблоны (template), core-файлы, инструкции и best practices для новых проектов. Не используйте memory-bank для обмена рабочими или архивными данными. Все federation/import/export, архивирование и восстановление выполняются только через archive/<origin>/ в корне репозитория.

Memory Bank — модуль для хранения, генерации и обмена знаниями, решениями, паттернами и контекстом между проектами, AI-ассистентами и командой.

## Структура
- core-файлы: activeContext.md, decisionLog.md, productContext.md, progress.md, projectBrief.md, systemPatterns.md
- custom_modes/ — инструкции и YAML-конфиги для режимов работы (Architect, Code, Ask, Debug)
- knowledge_packages/ — примеры, паттерны, брифы, phase-файлы
- .cursor/rules/isolation_rules/ — изоляционные правила и примеры
- developer-primer.md — гайд для разработчиков
- process-map.md — визуальные карты процессов

## Основано на:
- https://github.com/vanzan01/cursor-memory-bank
- https://github.com/GreatScottyMac/roo-code-memory-bank

## CREATIVE MODE (Design)

CREATIVE MODE предназначен для генерации архитектурных и UI-решений, мозгового штурма, визуализации идей и фиксации креативных паттернов.

### Как использовать
- Для проектирования архитектуры, UI, новых фич — активируйте CREATIVE MODE.
- Все решения и варианты фиксируйте в файлах creative-*.md (knowledge_packages/ или отдельная папка).
- Для визуализации используйте Mermaid (диаграммы, схемы).
- Обсуждайте и документируйте альтернативные подходы, плюсы/минусы, риски.

### Workflow
1. Активируйте CREATIVE MODE (см. custom_modes/creative_instructions.md).
2. Оформляйте идеи и решения в отдельном файле creative-<topic>.md.
3. Визуализируйте архитектуру/процессы с помощью Mermaid.
4. После согласования — переносите финальное решение в decisionLog.md и systemPatterns.md.

### Best practices
- Не ограничивайте себя одним вариантом — фиксируйте альтернативы.
- Используйте визуализацию для сложных решений.
- Все креативные решения должны быть доступны команде для обсуждения.
- После утверждения — обязательно логируйте итоговое решение.

## Как использовать
1. Заполняйте core-файлы по мере работы над проектом.
2. Следуйте инструкциям и YAML-конфига в custom_modes/ для разных фаз.
3. Используйте knowledge_packages/ как примеры и шаблоны.
4. Для интеграции с AI и автоматизации — используйте REST/MCP endpoint'ы.

## Best practices
- Все шаблоны и знания оформлять в формате markdown
- Документировать каждое решение и паттерн
- Использовать визуализацию (Mermaid, Graphviz) для процессов
- Поддерживать актуальность projectBrief.md и productContext.md 

## Интеграция с MCP/Task Tracker

> **Внимание:** В рамках Cursor AI MCP все задачи, баги, улучшения и прогресс фиксируются исключительно в основном сервисе (MCP/Task Tracker). Memory Bank не является таск-трекером, а служит журналом и контекстным отражением для AI, автоматизации и команды.

### Рекомендации по интеграции
- Все новые задачи, баги, улучшения создаются и обновляются только через MCP (API, UI, CLI).
- Memory Bank автоматически синхронизируется с MCP: события, статусы, решения, прогресс отражаются в core-файлах (decisionLog.md, activeContext.md, progress.md и др.).
- ACT (AI Context Tracker) отслеживает действия в MCP и обновляет Memory Bank для поддержки AI, federation и автоматизации.
- Не допускается ручное добавление задач или багов напрямую в Memory Bank — только через MCP.

### Пример workflow
1. Пользователь ставит задачу через MCP (UI/API).
2. MCP сохраняет задачу, присваивает ID, обновляет статус.
3. MCP отправляет событие в Memory Bank (decisionLog.md, activeContext.md).
4. ACT отслеживает действия, обновляет историю и контекст в Memory Bank.
5. При появлении багов/улучшений — фиксировать их только в MCP, а Memory Bank отражает эти события для AI и автоматизации.

> **Важно:** Memory Bank — это "журнал" и "контекстная шина". Все задачи и баги ведутся только в MCP. Memory Bank хранит историю, решения и контекст для AI и команды.

### Чеклист: Проверка подключения к MCP/Task Tracker

- [ ] Выполнен healthcheck MCP API (`/health`)
- [ ] Получен валидный ответ и статус "OK"
- [ ] Тестовая задача из MCP появилась в Memory Bank
- [ ] Логи интеграции фиксируют успешную синхронизацию
- [ ] В интерфейсе Memory Bank отображается статус подключения 

## Архивация и индексация для больших проектов
- При превышении 100КБ knowledge packages или логов используйте архивирование (например, перенос старых файлов в архив/архивные папки).
- Для быстрого поиска используйте индексацию по ключевым словам, датам, авто-генерацию оглавлений.

## План миграции структуры Memory Bank
- Перед изменением структуры делайте полный бэкап.
- Используйте скрипты миграции для переноса данных между версиями структуры.
- Все миграции фиксируйте в auditLog.md.

## Катастрофоустойчивость и DRP
- При недоступности MCP или Memory Bank используйте последний бэкап для восстановления.
- Храните резервные копии в защищённом облаке и локально.
- Регулярно тестируйте восстановление из бэкапа (DRP).
- Описывайте все действия по восстановлению в auditLog.md.

## Onboarding checklist
- [ ] Прочитать developer-primer.md и README.md
- [ ] Ознакомиться с core-файлами и knowledge packages
- [ ] Пройти инструкцию по добавлению нового knowledge package
- [ ] Ознакомиться с правилами changelog и аудита
- [ ] Настроить автоматические бэкапы

## Контроль версий и автоматизация changelog
- Все изменения фиксируются в git-истории.
- При каждом pull request или merge обновляйте CHANGELOG.md (автоматически или вручную).
- Используйте шаблон changelog из корня проекта.

## AI Automation Scenarios

- Для архивации knowledge packages вызывай:
  `mcp archive-knowledge-package <file>`
- Для миграции структуры:
  `mcp migrate-memory-bank --from <v1> --to <v2>`
- Для восстановления из бэкапа:
  `mcp restore-memory-bank <backup-file>`
- Для обновления changelog:
  `mcp update-changelog <message>`
- Для теста DRP:
  `mcp test-drp`
- Для поиска:
  `mcp search-knowledge <keyword>`

> **Важно:** Не редактируй архивные, changelog и audit файлы напрямую — только через команды MCP!

### Примеры промптов для AI
- "Архивируй knowledge package phase-dev.md"
- "Проведи тест DRP"
- "Восстанови Memory Bank из последнего бэкапа"
- "Обнови changelog после миграции"

## Глубокая интеграция AI-ассистента

- AI-ассистент анализирует историю изменений, changelog, auditLog.md, knowledge packages.
- Сам предлагает или инициирует:
  - Создание снапшота при рисках, merge, release, завершении Epic
  - Откат к стабильному снапшоту при ошибках
  - Генерацию knowledge package при новых паттернах, багах, улучшениях
  - Сравнение версий, аудит изменений, внедрение best practices
- Все действия AI фиксируются в auditLog.md и changelog.

### Примеры промптов для AI
- "Рекомендую создать снапшот перед слиянием — создать сейчас?"
- "Обнаружен баг — создать knowledge package и зафиксировать?"
- "Сравнить текущую реализацию с успешным снапшотом?"
- "Внедрить best practices из knowledge package X?"

### Best practices для AI-инициированных действий
- Всегда логировать автоматические действия AI в auditLog.md и changelog
- Перед откатом или изменением — предлагать пользователю подтвердить действие
- При генерации knowledge package — использовать шаблоны и фиксировать источник (причину)
- Анализировать историю ошибок и успехов для проактивных советов 

## Примеры автоматизации для AI-ассистента

### 1. Создание снапшота перед merge/release
**Промпт:**
«Рекомендую создать снапшот перед слиянием — создать сейчас?»
**Автоматизация:**
- AI вызывает MCP endpoint:
  ```python
  import requests
  resp = requests.post('http://localhost:8001/projects/1/snapshot', headers={'X-API-KEY': '...'})
  ```
- После подтверждения пользователя — логирует событие в auditLog.md и changelog.

### 2. Генерация knowledge package при баге/паттерне
**Промпт:**
«Обнаружен баг — создать knowledge package и зафиксировать?»
**Автоматизация:**
- AI создает файл в knowledge_packages/ с шаблоном для бага/паттерна.
- Добавляет запись в changelog и auditLog.md.

### 3. Откат к стабильному снапшоту
**Промпт:**
«В последних коммитах обнаружено много ошибок. Откатить проект к снапшоту snapshot-X?»
**Автоматизация:**
- После подтверждения пользователя — вызывает MCP endpoint для отката:
  ```python
  resp = requests.post('http://localhost:8001/projects/1/rollback', headers={'X-API-KEY': '...'}, json={'snapshot': 'snapshot-X'})
  ```
- Логирует событие.

### 4. Сравнение с успешным снапшотом
**Промпт:**
«Сравнить текущую реализацию с успешным снапшотом snapshot-Y?»
**Автоматизация:**
- AI извлекает файлы из снапшота, делает diff с текущей версией, показывает различия пользователю.
- Логирует результат сравнения.

### 5. Внедрение best practices из knowledge package
**Промпт:**
«Внедрить best practices из knowledge package X?»
**Автоматизация:**
- AI анализирует шаблон, предлагает изменения в коде/процессах, фиксирует внедрение в changelog и auditLog.md.

### 6. Автоматические действия по расписанию или событиям
- Раз в неделю AI предлагает сделать снапшот, провести аудит, обновить документацию.

### Best practices для автоматизации
- Всегда спрашивать подтверждение пользователя для критичных действий (откат, удаление, overwrite).
- Логировать все автоматические действия AI.
- Использовать шаблоны knowledge packages для новых багов, паттернов, улучшений.
- Анализировать историю ошибок и успехов для проактивных советов. 

## Быстрый старт: автоматическая инициализация Memory Bank

Для создания структуры Memory Bank используйте CLI-команду:

```bash
python scripts/init_memory_bank.py
```

Команда создаёт папку memory-bank/ и все core-файлы с шаблонным содержимым (activeContext.md, decisionLog.md, productContext.md, progress.md, projectBrief.md, systemPatterns.md). 

---

# Onboarding: Быстрый старт для новых участников

1. Ознакомьтесь с архитектурой хранения: archive/<origin>/ — для обмена и архивирования, memory-bank/ — только шаблоны и best practices.
2. Для новых проектов используйте шаблоны из memory-bank/.
3. Для обмена знаниями используйте только archive/<origin>/ и CLI-команды federation.
4. Все операции federation/import/export выполняйте только по своему origin.
5. Перед импортом делайте бэкап, проверяйте метаданные и фиксируйте действия в changelog/auditLog.
6. В случае вопросов — обращайтесь к developer-primer.md и README.md в archive, memory-bank, federation. 